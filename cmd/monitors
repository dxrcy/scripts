#!/bin/sh
export INFO='set display mode with xrandr based on number of connected displays'
# xrandr commands generated by arandr

~/scripts/cmd/require xrandr || exit 1

get_monitor_count() {
    xrandr | awk '/ connected/ {count++} END {print count}'
}

# Get number of connected displays
case "$1" in
    1|2) monitor_count="$1" ;;
    'auto') monitor_count=$(get_monitor_count) ;;
    '')
        get_monitor_count
        exit 0
        ;;
    *) 
        echo 'monitors: invalid monitor number'
        echo 'USAGE:'
        echo '    monitors [ 1 | 2 | auto ]'
        echo '       Apply monitor settings'
        echo '    monitors'
        echo '       Get monitor count'
        exit 1
        ;;
esac

if [ ! "$monitor_count" = '2' ]; then
    # Single display, or fallback
    xrandr  --output eDP-1 --primary --mode 1680x1050 --pos 0x0 --rotate normal \
            --output HDMI-1 --off \
            --output DP-1 --off \
            --output DP-2 --off \
            --output DP-3 --off \
            --output DP-4 --off
    echo 'Applied xrandr settings for 1 monitor'
else
    # Secondary monitor
    xrandr  --output eDP-1 --primary --mode 1680x1050 --pos 0x0 --rotate normal \
            --output HDMI-1 --mode 1920x1080 --pos 1680x0 --rotate normal \
            --output DP-1 --off \
            --output DP-2 --off \
            --output DP-3 --off \
            --output DP-4 --off
    echo 'Applied xrandr settings for 2 monitors'
fi
